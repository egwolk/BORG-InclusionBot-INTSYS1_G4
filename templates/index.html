<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>InclusionBot — Local UI</title>
  <style>
    body { font-family: Arial, sans-serif; max-width:700px; margin:2rem auto; }
    #chat { border:1px solid #ccc; padding:1rem; min-height:200px; white-space:pre-wrap; }
    #input { width:100%; padding:0.5rem; margin-top:0.5rem; }

    #status { margin-top:0.5rem; color:#666; min-height:1.2em; }
    @keyframes blink {
      0% { opacity: .3; }
      50% { opacity: 1; }
      100% { opacity: .3; }
    }
    #status.thinking { animation: blink 1s infinite; }
  </style>
</head>
<body>
  <h2>InclusionBot — Local UI</h2>
  <div id="chat">System ready. Ask something.</div>
  <div id="status" aria-live="polite"></div>
  <input id="input" placeholder="Type a message and press Enter" />
  <script>
    const input = document.getElementById('input');
    const chat = document.getElementById('chat');
    const status = document.getElementById('status');

    input.addEventListener('keydown', async (e) => {
      if (e.key === 'Enter') {
        const text = input.value.trim();
        if (!text) return;
        chat.textContent += '\n\nYou: ' + text;
        input.value = '';

        status.textContent = 'Borg is thinking...';
        status.classList.add('thinking');
        input.disabled = true;

        try {
          const res = await fetch('/chat', {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({message: text})
          });
          const j = await res.json();
          if (j.reply) {
            chat.textContent += '\n\nBorg: ' + j.reply;
          } else {
            chat.textContent += '\n\nError: ' + (j.error || 'unknown');
          }
        } catch (err) {
          chat.textContent += '\n\nError: ' + err.message;
        } finally {
          status.textContent = '';
          status.classList.remove('thinking');
          input.disabled = false;
          input.focus();
          chat.scrollTop = chat.scrollHeight;
        }
      }
    });
  </script>
</body>
</html>